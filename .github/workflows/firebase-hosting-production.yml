# Deploy to Firebase Hosting - Production when pushing to main
name: Deploy to Production

on:
  push:
    branches:
      - main

jobs:
  build_and_deploy_production:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build for Production
        run: npm run build:prod
        env:
          VITE_SUPABASE_URL: ${{ secrets.PROD_SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.PROD_SUPABASE_ANON_KEY }}
          VITE_API_URL: https://api.mdenglish.us
          VITE_APP_URL: https://portal.mdenglish.us

      - name: Deploy to Firebase Hosting (Production)
        run: npx firebase-tools deploy --only hosting:production --token "${{ secrets.FIREBASE_TOKEN }}"

